---

import ChevronRightIcon from '../Icons/ChevronRightIcon.astro';
import BookOpenIcon from '../Icons/BookOpenIcon.astro';
import ClockIcon from '../Icons/ClockIcon.astro';
import UsersIcon from '../Icons/UsersIcon.astro';


import { contentfulClient } from "../lib/contentful";
import { documentToHtmlString } from "@contentful/rich-text-html-renderer";
import type { EntryFieldTypes } from "contentful";

export interface Modulos {
  contentTypeId: "modulos";
  fields: {
    Nmodulos: EntryFieldTypes.Text;
    Dmodulos: EntryFieldTypes.Text;
  };
}

interface Programa  {
  contentTypeId: "programa",
  fields: {
    title: EntryFieldTypes.Text
    description: EntryFieldTypes.Text
    slug: EntryFieldTypes.Text
    cover: EntryFieldTypes.AssetLink,
    modulos: EntryFieldTypes.Array<EntryFieldTypes.EntryLink<Modulos>>;
  }
}

const { items: entries } = await contentfulClient.getEntries<Programa>({
  content_type: "programa",
});
---

{entries
  .sort((a, b) => a.fields.title.localeCompare(b.fields.title))
  .map((p, index) => (
    <div class="group animate-fade-in-up" style={`animation-delay: ${index * 0.15}s`}>
      <a
        href={`/programas/${p.fields.slug ?? "programa"}`}
        class="card card-hover block h-full overflow-hidden relative"
      >
        <!-- Imagen con overlay mejorado -->
        <div class="relative h-56 overflow-hidden">
          <img
            src={p.fields.cover.fields.file.url}
            alt={p.fields.title}
            class="w-full h-full object-cover transition-all duration-700 group-hover:scale-110"
            loading="lazy"
          />
          
          <!-- Overlay con gradiente sofisticado -->
          <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-black/40 to-transparent"></div>
          
          <!-- Badge de programa -->
          <div class="absolute top-4 left-4">
            <span class="inline-flex items-center gap-2 px-3 py-1 bg-white/20 backdrop-blur-sm border border-white/30 rounded-full text-white text-xs font-semibold">
              <BookOpenIcon class="h-3 w-3" />
              Programa
            </span>
          </div>
          
          <!-- Título superpuesto con mejor tipografía -->
          <div class="absolute bottom-6 left-6 right-6">
            <h3 class="text-white text-2xl font-bold leading-tight mb-2 group-hover:text-secondary-300 transition-colors">
              {p.fields.title}
            </h3>
            
            <!-- Metadatos rápidos -->
            <div class="flex items-center gap-4 text-white/80 text-sm">
              <div class="flex items-center gap-1">
                <ClockIcon class="h-4 w-4" />
                <span>8 semanas</span>
              </div>
              <div class="flex items-center gap-1">
                <UsersIcon class="h-4 w-4" />
                <span>{p.fields.modulos.length} módulos</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Contenido de la tarjeta mejorado -->
        <div class="content-padding">
          <!-- Descripción con mejor espaciado -->
          <p class="text-gray-600 dark:text-gray-300 mb-6 leading-relaxed line-clamp-3">
            {p.fields.description}
          </p>

          <!-- Footer de la tarjeta -->
          <div class="flex items-center justify-between">
            <!-- Información del programa -->
            <div class="flex flex-col">
              <span class="text-sm text-primary-600 dark:text-primary-400 font-medium">
                {p.fields.modulos.length} módulo{p.fields.modulos.length !== 1 ? 's' : ''}
              </span>
              <span class="text-xs text-gray-500 dark:text-gray-400">
                Certificación incluida
              </span>
            </div>
            
            <!-- CTA mejorado -->
            <div class="flex items-center text-secondary-600 dark:text-secondary-400 font-semibold group-hover:text-secondary-700 dark:group-hover:text-secondary-300 transition-all duration-300">
              <span>Ver programa</span>
              <ChevronRightIcon class="h-5 w-5 ml-1 transition-transform group-hover:translate-x-1" />
            </div>
          </div>
          
          <!-- Barra de progreso visual -->
          <div class="mt-4 w-full h-1 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
            <div class="h-full bg-gradient-to-r from-secondary-500 to-secondary-600 rounded-full transform scale-x-0 group-hover:scale-x-100 transition-transform duration-700 origin-left"></div>
          </div>
        </div>
        
        <!-- Efecto de brillo en hover -->
        <div class="absolute inset-0 opacity-0 group-hover:opacity-100 transition-opacity duration-500 pointer-events-none">
          <div class="absolute top-0 left-0 w-full h-full bg-gradient-to-r from-transparent via-white/5 to-transparent transform -skew-x-12 -translate-x-full group-hover:translate-x-full transition-transform duration-1000"></div>
        </div>
      </a>
    </div>
  ))}

<style>
  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>